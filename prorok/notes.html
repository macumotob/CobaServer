<!DOCTYPE html>
<html>
<head>
  <title>Заметки</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="HandheldFriendly" content="true">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  <meta http-equiv="pragma" content="no-cache">
	<meta charset="utf-8" />

  <link rel="stylesheet" href="http://134.249.167.212:3000/css/bootstrap.min.css" />
  <link rel="stylesheet" href="http://134.249.167.212:3000/css/bootstrap-dialog.min.css" />

  <link rel="stylesheet" href="http://134.249.167.212:3000/css/vasyl.css" />
<style>

#left-panel{
 left:0%;
 top:0%;
 width:30%;
 height:90%;
 position:absolute;

 border : 1px solid green;
}
#right-panel{
 left:30%;
 top:0%;
 width:70%;
 height:90%;
 position:absolute;
 border : 1px solid blue;
}
#bottom-panel{
 left:0%;
 bottom:0%;
 width:100%;
 height:10%;
 position:absolute;
}
 .note-file {
    width:95%;
    margin:10px;
    cursor:pointer;
    color:#78CC4F;
  }
  .note-file:hover { 
    background-color: yellow;
    color: black;
  }

    /*          */

  div.container {
    width: 100%;
    margin: 0px;
    line-height: 150%;
  }
  div.header {
    color: white;
    background-color: gray;
    clear: left;
    width: 100%;
  }
  div.footer {
    color: white;
    background-color: gray;
    clear: left;
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    text-align:right;
    font-family:Tahoma;
    font-size:0.6em;
  }
  div.header table {
    width: 100%;
  }
  h1.header {
    padding: 0;
    margin: 0;
  }

#note  {
  font-size:1.3em;
  width:100%;
  color:#669C4C;
  height:100%;
  background-color:black;  
}
</style>

<script type="text/javascript" src="http://134.249.167.212:3000/js/loader.js"></script>

  <script type="text/javascript">
    var notes = (function () {
      var file_name;
      var current_note;
      var note_value;
      var current_note_name;

      function init() {
        if (current_note_name) {
          return;
        }
        current_note = id("current-note");
        note_value = id("note");
        current_note_name = id("current-note-name");
      }
      //
      function get_list() {
        init();
        load_async_json("notes.list?tm=" + new Date().getTime(), function (data) {
          var s = "";
          
          data.forEach(function (item) {
            s += "<div class='note-file' data-method='notes.edit' data-args='" + item + "'>" + item
              + "<span class='glyphicon glyphicon-trash pull-right' data-method='notes.drop' data-args='" + item + "'></span></div>";
          });
          id("left-panel").innerHTML = s;

          var file = data[0];
          get(file);
        });
      }
      //
      function save(onsuccess) {
        var txt = encodeURI(note_value.value);
        post("note.save?", "date=" + file_name + "&txt=" + txt, function (data) {
          id("note-save-result").innerText = "Файл: " + file_name + " " + data.msg;
          if (onsuccess) onsuccess();
        });
      }
      //
      function get(file) {
        load_async("/notes?date=" + file, function (data) {
          current_note.innerHTML = file;
          //current_note_name.value = file;
          file_name = file;
          note_value.value = data;
        });
      }
      function edit(file) {
        var ext = mb.get_file_ext(file);
        if (ext === "txt") {
          save(function () { get(file); });
        }
        else {
          current_note.innerHTML = file;
          id("audio").src = "/notes.wav?file="+file;
        }
      }
      //
      function drop(file) {
        if(confirm("Do you real want drop file " + file)){
          load_async_json("/notes.remove?file=" + file_name, function (data) {
            get_list();
          });
        }
      }
      //
      function create() {
        save(function () {
          file_name = current_note_name.value;
          post("note.save?", "date=" + file_name + "&txt=new file", function (data) {
            id("note-save-result").innerText = "Файл: " + file_name + " " + data.msg;
          });
        });
      }
      return {
        "list": get_list,
        "edit": edit,
        "create":create,
        "save": save,
        "drop": drop
      };
    })();

    window.addEventListener('click', function () {
      mb.onclick();
    });
    document.addEventListener("keydown", function (e) {
      if (e.keyCode == 83 && (navigator.platform.match("Mac") ? e.metaKey : e.ctrlKey)) {
        e.preventDefault();
        notes.save();
      }
    }, false);

  </script>
</head>
<body onload="notes.list();">
  <div id="left-panel" class="coba-scrolable"></div>  
  <div id="right-panel">
    <div id="current-note" style="font-size:2em;text-align:center;color:yellow;padding:20px;width:100%;">File not selected</div>
    <!--<div  style="width:100%;">
      <audio controls autoplay id="audio"></audio>
    </div>-->
    <div  style="width:100%;position:relative;height:75%;">
      <textarea id="note"  value=""></textarea>
    </div>
  </div>

  <div id="bottom-panel">    
    <table style="width:100%">
      <tr>
        <td>New file name</td>
        <td><input type="text" id="current-note-name" value="" /></td>
        <td data-method="notes.create"><span class="glyphicon glyphicon-plus"></span></td>
        <td id="btn-login-form"><li><a class="chat-li"><span class="glyphicon glyphicon-user"></span></a></li></td>
        <td id="btn-search-contact"><li><a class="chat-li"><span class="glyphicon glyphicon-search"></span></a></li></td>

        <td id="note-save-result" colspan="4">Status</td>
      </tr>
      <tr>
      <td colspan="5"><audio controls autoplay id="audio"></audio></td>
      </tr>
    </table>
  </div>


</body>
</html>
